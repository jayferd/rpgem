<%
  ruby_ver = begin
    v = spec.required_ruby_version.to_s
    v = ">= 0" ? "" : " #{v}"
  end
  rubygems_ver = begin
    v = spec.required_rubygems_version.to_s
    v = ">= 0" ? "" : " #{v}"
  end

%>
%define rbname <%= spec.name %>

Name:		rpgem-%{rbname}
Version:  <%= spec.version.to_s %>
Release:	1%{?dist}
Summary:	<%= spec.summary || spec.description %>

Group: Development/Languages/Ruby
License:  <%= spec.license || "#FIXME - this gem has an unspecified license!" %>
URL:  <%= spec.homepage %>
Source0:  %{_sourcedir}/%{rbname}-%{version}.gem
BuildRoot:	%(mktemp -ud %{_tmppath}/%{name}-%{version}-%{release}-XXXXXX)
Vendor: <%= spec.author %>

BuildRequires: ruby<%=ruby_ver%><%=rubygems_ver%>
Requires:	ruby<%=ruby_ver%>, rubygems<%=rubygems_ver%><%=
  spec.runtime_dependencies.map do |d|
    ", rpgem-#{d.name} #{d.requirements_list.first.gsub(/~>/,'>=')}"
  end.join
%>

Prefix: <%=@prefix%>

%description
<%= spec.description %>

%prep
#noop

%build
rm -rf $RPM_BUILD_ROOT
mkdir $RPM_BUILD_ROOT
gem install %{SOURCE0} --force --local --no-rdoc --no-ri --install-dir=.

%install
#echo "moving gem files to %{local_gems_dir}..."

rm -rf $RPM_BUILD_ROOT%{prefix}
tree $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT%{prefix}
mv * $RPM_BUILD_ROOT%{prefix}
chmod -R 0755 $RPM_BUILD_ROOT%{prefix}

%clean
rm -rf $RPM_BUILD_ROOT


%files
%defattr(-,root,root,-)
%{prefix}/gems/%{rbname}-%{version}/
%{prefix}/specifications/%{rbname}-%{version}.gemspec
%{prefix}/cache/%{rbname}-%{version}.gem
<% spec.executables.each do |e| %>
%{prefix}/bin/<%= e %>
<% end %>


%changelog
